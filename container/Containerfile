FROM docker.io/golang:latest as builder
RUN --mount=type=bind,source=/,target=/register-ilugc,rw sh -c 'cd /register-ilugc && make && tar cvzf register-ilugc.tar.gz src/cmd/register static && make clean && touch /.completed'

FROM scratch
COPY --from=builder /.completed /.completed
ADD register-ilugc.tar.gz /register-ilugc
VOLUME ["/data"]
EXPOSE 2203
WORKDIR /data
ENTRYPOINT ["/register-ilugc/src/cmd/register"]
